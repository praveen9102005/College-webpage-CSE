<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Student Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/student.css">
</head>

<body>

<div class="wrap">

<!-- ================= HEADER ================= -->
<header class="site">
  <div class="brand">
    <div class="logo">SN</div>
    <div>
      <h1>Student Dashboard</h1>
      <p class="small">Attendance Â· Internal Marks Â· eBooks Â· Syllabus</p>
    </div>
  </div>

  <div class="profile">
    <div class="profile-info">
      <div id="displayNameTop">Student</div>
      <div id="displayRegYear" class="small">Reg: â€” â€¢ Year: â€”</div>
    </div>

    <div class="avatar">
      <img src="/Images/user.png" alt="profile">
    </div>

    <button id="editBtn" class="btn ghost">Edit</button>
    <button id="logoutBtn" class="btn ghost">Logout</button>
  </div>
</header>

<!-- ================= MAIN ================= -->
<main>

<section class="panel">
  <h2>Attendance</h2>
  <div class="attendance-grid">
    <div class="att-card"><h3>Overall</h3><p>92%</p></div>
    <div class="att-card"><h3>Last 30 Days</h3><p>95%</p></div>
    <div class="att-card"><h3>Missed</h3><p>3</p></div>
  </div>
</section>

<section class="panel">
  <h2>Internal Marks</h2>
  <table>
    <tr><th>Subject</th><th>Test 1</th><th>Test 2</th></tr>
    <tr><td>Maths</td><td>18</td><td>17</td></tr>
    <tr><td>Physics</td><td>16</td><td>18</td></tr>
    <tr><td>DS</td><td>19</td><td>18</td></tr>
  </table>
</section>

<section class="panel">
  <a href="ebooks.html"><h2>ðŸ“˜ eBooks</h2></a>
</section>

<section class="panel">
  <h2>Syllabus</h2>
  <details><summary>Maths</summary><p>Calculus, Algebra</p></details>
  <details><summary>Physics</summary><p>Mechanics, Optics</p></details>
  <details><summary>DS</summary><p>Arrays, Trees, Graphs</p></details>
</section>

</main>

<aside>
<section class="panel">
  <h2>Conference Alerts</h2>
  <p>AI & ML Workshop â€“ 20 Dec 2025</p>
  <p>Paper Submission â€“ 10 Jan 2026</p>
</section>
</aside>

<footer>Â© 2025 Student Dashboard</footer>
</div>

<!-- ================= EDIT PROFILE MODAL ================= -->
<div id="modalBackdrop" class="modal-backdrop">
<div class="modal">

<h3>Complete Your Profile</h3>

<div class="field">
  <label>Name *</label>
  <input id="inputName">
</div>

<div class="field">
  <label>Register No *</label>
  <input id="inputReg">
</div>

<div class="field">
  <label>Year *</label>
  <select id="inputYear">
    <option value="">Select</option>
    <option>1st Year</option>
    <option>2nd Year</option>
    <option>3rd Year</option>
    <option>4th Year</option>
  </select>
</div>

<div class="field">
  <label>Phone Number *</label>
  <input id="inputPhone" type="tel" maxlength="10">
</div>

<div class="field">
  <label>Date of Birth</label>
  <input id="inputDob" type="date">
</div>

<div class="field">
  <label>Age</label>
  <input id="inputAge" readonly>
</div>

<div class="field">
  <label>Gender</label>
  <select id="inputGender">
    <option value="">Select</option>
    <option>Male</option>
    <option>Female</option>
    <option>Other</option>
  </select>
</div>

<div class="actions">
  <button id="cancelBtn" class="btn ghost">Cancel</button>
  <button id="saveBtn" class="btn">Save</button>
</div>

</div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBk2hRR4QzGjrXPkge_hPVEZ1Tv6jQR58A",
  authDomain: "college-webpage-eab22.firebaseapp.com",
  projectId: "college-webpage-eab22",
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* UI */
const modal = document.getElementById("modalBackdrop");
const editBtn = document.getElementById("editBtn");
const cancelBtn = document.getElementById("cancelBtn");
const saveBtn = document.getElementById("saveBtn");
const logoutBtn = document.getElementById("logoutBtn");

const inputName = document.getElementById("inputName");
const inputReg = document.getElementById("inputReg");
const inputYear = document.getElementById("inputYear");
const inputPhone = document.getElementById("inputPhone");
const inputDob = document.getElementById("inputDob");
const inputAge = document.getElementById("inputAge");
const inputGender = document.getElementById("inputGender");

const displayNameTop = document.getElementById("displayNameTop");
const displayRegYear = document.getElementById("displayRegYear");

let isFirstTime = false;

/* AGE */
inputDob.onchange = () => {
  if (!inputDob.value) return;
  const d = new Date(inputDob.value);
  inputAge.value = new Date().getFullYear() - d.getFullYear();
};

/* AUTH */
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "auth.html";
    return;
  }

  const ref = doc(db, "users", user.uid);
  const snap = await getDoc(ref);

  if (!snap.exists() || !snap.data().profileCompleted) {
    isFirstTime = true;
    modal.style.display = "grid";
    cancelBtn.style.display = "none";
    return;
  }

  const p = snap.data();
  displayNameTop.textContent = p.name;
  displayRegYear.textContent = `Reg: ${p.reg} â€¢ Year: ${p.year}`;
});

/* SAVE */
saveBtn.onclick = async () => {
  const phone = inputPhone.value.trim();

  if (!inputName.value || !inputReg.value || !inputYear.value || !phone) {
    alert("Fill all required fields");
    return;
  }

  if (!/^[6-9]\d{9}$/.test(phone)) {
    alert("Enter valid 10-digit phone number");
    return;
  }

  await setDoc(doc(db, "users", auth.currentUser.uid), {
    name: inputName.value,
    reg: inputReg.value,
    year: inputYear.value,
    phone,
    dob: inputDob.value,
    age: inputAge.value,
    gender: inputGender.value,
    role: "student",
    profileCompleted: true
  }, { merge: true });

  displayNameTop.textContent = inputName.value;
  displayRegYear.textContent = `Reg: ${inputReg.value} â€¢ Year: ${inputYear.value}`;
  modal.style.display = "none";
};

/* BUTTONS */
editBtn.onclick = () => modal.style.display = "grid";
cancelBtn.onclick = () => {
  if (isFirstTime) return alert("Complete profile first");
  modal.style.display = "none";
};

logoutBtn.onclick = async () => {
  await signOut(auth);
  window.location.href = "login.html";
};
</script>

</body>
</html>
